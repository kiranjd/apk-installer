#!/bin/zsh
set -euo pipefail

# Simple fake adb for manual UI testing (no real devices required).
# Supports: version, devices (-l), install, uninstall, shell pm clear

if [[ -n "${ADB_LOG_FILE:-}" ]]; then
  printf "%s\n" "$*" >> "$ADB_LOG_FILE"
fi

# Strip optional device selector.
if [[ "${1:-}" == "-s" ]]; then
  shift 2
fi

cmd="${1:-}"
shift || true

case "$cmd" in
  version)
    cat <<OUT
Android Debug Bridge version 1.0.41
Version 36.0.0-fake
Installed as $(cd "$(dirname "$0")" && pwd)/adb
OUT
    ;;

  devices)
    # Ignore flags like -l.
    cat <<'OUT'
List of devices attached
emulator-5554 device product:sdk model:Pixel device:emu transport_id:1
OUT
    ;;

  install)
    # Accept flags (-t, -r, etc) then a final path.
    apk_path="${@: -1}"
    if [[ -z "$apk_path" ]]; then
      echo "Missing APK path" >&2
      exit 2
    fi
    if [[ ! -f "$apk_path" ]]; then
      echo "APK not found: $apk_path" >&2
      exit 3
    fi
    echo "Success"
    ;;

  uninstall)
    echo "Success"
    ;;

  shell)
    # Support: shell pm clear <pkg>
    echo "Success"
    ;;

  *)
    echo "Unsupported command: $cmd $*" >&2
    exit 1
    ;;
esac
